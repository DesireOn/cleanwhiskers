{% extends 'base.html.twig' %}

{% block title %}Lead Claimed{% endblock %}

{% block body %}
  <section class="container" style="max-width:720px;margin:2rem auto;">
    <h1>Lead claimed successfully</h1>
    <p>You claimed the {{ serviceName }} lead in {{ cityName }}.</p>

    <div class="card" style="margin-top:1rem;padding:1rem;">
      <p style="margin:0 0 .25rem 0;"><strong>Service:</strong> {{ serviceName }}</p>
      <p style="margin:0 0 .25rem 0;"><strong>City:</strong> {{ cityName }}</p>
      {% if lead.claimedAt %}
        <p style="margin:0 0 .25rem 0;"><strong>Claimed at:</strong> {{ lead.claimedAt|date('H:i, M j') }}</p>
      {% endif %}
    </div>

    <h2 style="margin-top:1.5rem;">Owner contact</h2>
    <div class="card" style="margin-top:.5rem;padding:1rem;">
      <p style="margin:0 0 .25rem 0;"><strong>Name:</strong> {{ lead.fullName }}</p>
      <p style="margin:0 0 .25rem 0;"><strong>Email:</strong> <a href="mailto:{{ lead.email }}">{{ lead.email }}</a></p>
      {% if lead.phone %}
        <p style="margin:0 0 .25rem 0;"><strong>Phone:</strong> <a href="tel:{{ lead.phone }}">{{ lead.phone }}</a></p>
      {% endif %}
      {% if lead.petType %}
        <p style="margin:0 0 .25rem 0;"><strong>Pet type:</strong> {{ lead.petType }}</p>
      {% endif %}
      {% if lead.breedSize %}
        <p style="margin:0;"><strong>Breed/Size:</strong> {{ lead.breedSize }}</p>
      {% endif %}
    </div>

    <h2 style="margin-top:1.5rem;">Next steps</h2>
    <ol style="margin-top:.5rem; padding-left:1.25rem;">
      <li>Introduce yourself by email or phone within 1–2 hours.</li>
      <li>Reference their request for {{ serviceName }} in {{ cityName }}.</li>
      <li>Share availability, pricing, and how to book.</li>
      <li>If no response, follow up politely within 24–48 hours.</li>
    </ol>

    {% set email_subject = 'Regarding your ' ~ serviceName ~ ' request in ' ~ cityName %}
    {% set email_body -%}
Hi {{ lead.fullName }},

This is {{ groomerName }}. I just claimed your {{ serviceName }} request in {{ cityName }} and would love to help.

Availability: [share a couple of time windows]
Pricing: [share a simple estimate or range]
Next steps: [how to book or what you need from them]

{% if groomerPhone %}You can also call/text me at {{ groomerPhone }}.

{% endif %}Thanks!
{{ groomerName }}
    {%- endset %}

    <div style="margin-top:1rem; display:flex; gap:.75rem; flex-wrap:wrap;">
      <a class="btn" href="mailto:{{ lead.email }}?subject={{ email_subject|url_encode }}&body={{ email_body|url_encode }}">Email the owner now</a>
      {% if lead.phone %}
        <a class="btn" href="tel:{{ lead.phone }}">Call the owner</a>
      {% endif %}
      {% set copy_text -%}
Owner: {{ lead.fullName }}
Email: {{ lead.email }}
{% if lead.phone %}Phone: {{ lead.phone }}
{% endif %}Service: {{ serviceName }}
City: {{ cityName }}
{% if lead.petType %}Pet type: {{ lead.petType }}
{% endif %}{% if lead.breedSize %}Breed/Size: {{ lead.breedSize }}
{% endif %}{% if lead.claimedAt %}Claimed at: {{ lead.claimedAt|date('c') }}
{% endif %}
      {%- endset %}
      <button class="btn" id="copy-details">Copy details</button>
    </div>

    <script>
      (function () {
        var btn = document.getElementById('copy-details');
        if (!btn) return;
        var text = {{ copy_text|json_encode|raw }};
        btn.addEventListener('click', function () {
          try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).then(function () {
                btn.textContent = 'Copied!';
                setTimeout(function(){ btn.textContent = 'Copy details'; }, 2000);
              });
            } else {
              var ta = document.createElement('textarea');
              ta.value = text;
              ta.style.position = 'fixed';
              ta.style.opacity = '0';
              document.body.appendChild(ta);
              ta.focus();
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              btn.textContent = 'Copied!';
              setTimeout(function(){ btn.textContent = 'Copy details'; }, 2000);
            }
          } catch (e) {
            btn.textContent = 'Copy failed';
            setTimeout(function(){ btn.textContent = 'Copy details'; }, 2000);
          }
        });
      })();
    </script>

    <div style="margin-top:1.25rem;">
      <a class="btn" href="{{ path('app_homepage') }}">Go to Homepage</a>
    </div>
  </section>
{% endblock %}
