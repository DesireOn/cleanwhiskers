{#
  Lead invite email (HTML)
  Expected context (preferred):
    - serviceName (string)
    - cityName (string)
    - claimUrl (string)
    - unsubUrl (string)
    - expiresAt (\DateTimeInterface|string)
    - companyName (string)
    - companyAddress (string)
    - contactEmail (string)

  Fallbacks: if a Lead entity is provided as `lead`, service/city are derived via accessors.
  Company/contact values fall back to environment if available, then to sensible defaults.
#}
{% set service_name = serviceName is defined ? serviceName : (lead is defined ? lead.service.name : null) %}
{% set city_name = cityName is defined ? cityName : (lead is defined ? lead.city.name : null) %}

{# Company/contact fallbacks: prefer explicit context, else defaults #}
{% set company_name = companyName is defined and companyName ? companyName : 'CleanWhiskers' %}
{% set company_address = companyAddress is defined and companyAddress ? companyAddress : '123 Business Rd, City, Country' %}
{% set contact_email = contactEmail is defined and contactEmail ? contactEmail : 'support@example.com' %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ service_name and city_name ? ('Pet owner needs ' ~ service_name ~ ' in ' ~ city_name) : (service_name ? ('Pet owner needs ' ~ service_name) : 'New request available') }}</title>
    <style>
      /* Minimal, email-friendly styles (inline where important) */
      .btn { background:#2563eb; color:#ffffff !important; text-decoration:none; padding:12px 18px; border-radius:6px; display:inline-block; font-weight:600; }
      .text-muted { color:#6b7280; }
      .small { font-size:12px; }
      .container { max-width:640px; margin:0 auto; padding:0 16px; }
      .badge { display:inline-block; padding:2px 8px; font-size:12px; color:#1f2937; background:#e5e7eb; border-radius:999px; }
    </style>
  </head>
  <body style="margin:0; padding:0; background:#f6f8fb; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; color:#111827;">
    {# Preheader (hidden in most clients) #}
    <div style="display:none; max-height:0; overflow:hidden; mso-hide:all; font-size:1px; line-height:1px; color:#f6f8fb;">
      {% if service_name and city_name %}A pet owner requested {{ service_name }} in {{ city_name }}. Preview and claim. {% else %}A new local request is available. Preview and claim. {% endif %}
    </div>
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background:#f6f8fb;">
      <tr>
        <td align="center" style="padding:24px 0;">
          <table role="presentation" width="640" cellspacing="0" cellpadding="0" border="0" class="container" style="background:#ffffff; border-radius:10px; overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,0.06);">
            <tr>
              <td style="padding:24px 24px 8px 24px;">
                <div class="badge" style="display:inline-block; padding:2px 8px; font-size:12px; color:#1f2937; background:#e5e7eb; border-radius:999px;">New request</div>
                <h1 style="margin:8px 0 8px 0; font-size:22px; line-height:1.3;">
                  {% if service_name and city_name %}
                    A pet owner in {{ city_name }} needs {{ service_name }}
                  {% elseif service_name %}
                    A pet owner needs {{ service_name }}
                  {% else %}
                    A local pet owner needs your help
                  {% endif %}
                </h1>
                <p style="margin:0; color:#374151;">
                  We’re {{ company_name }}, a new platform helping local groomers connect with nearby pet owners.
                  This request looks like a good match for your business.
                </p>
              </td>
            </tr>

            <tr>
              <td style="padding:8px 24px 0 24px;">
                <p style="margin:0 0 16px 0; color:#111827;">Preview the details and claim it if it’s a fit. The secure link expires
                  {% if expiresAt is defined and expiresAt %}
                    on <strong>{{ expiresAt|date('Y-m-d H:i T') }}</strong>.
                  {% else %}
                    soon.
                  {% endif %}
                </p>
                {% if claimUrl is defined and claimUrl %}
                  <p style="margin:0 0 24px 0;">
                    <a class="btn" href="{{ claimUrl }}" target="_blank" rel="noopener">View request and claim</a>
                  </p>
                  <p class="text-muted" style="margin:0 0 8px 0; color:#6b7280;">If the button doesn’t work, copy and paste this link:</p>
                  <p class="small" style="margin:0 0 16px 0; word-break:break-all; color:#374151;">{{ claimUrl }}</p>
                {% endif %}
              </td>
            </tr>

            <tr>
              <td style="padding:8px 24px 24px 24px; border-top:1px solid #e5e7eb;">
                <p style="margin:0 0 6px 0; color:#374151; font-weight:600;">Why this email is safe</p>
                <p class="small text-muted" style="margin:0 0 4px 0; color:#6b7280; font-size:12px;">• See the request before you decide.</p>
                <p class="small text-muted" style="margin:0 0 4px 0; color:#6b7280; font-size:12px;">• No obligation — ignore if it’s not a fit.</p>
                <p class="small text-muted" style="margin:0 12px 12px 0; color:#6b7280; font-size:12px;">• One‑click unsubscribe anytime.</p>

                <p class="small text-muted" style="margin:0 0 8px 0; color:#6b7280; font-size:12px;">
                  Reason for contact: your business appears to match a pet owner’s request in our system (legitimate interest).
                </p>
                <p class="small text-muted" style="margin:0 0 8px 0; color:#6b7280; font-size:12px;">
                  Questions or feedback? Email <a href="mailto:{{ contact_email }}" style="color:#374151;">{{ contact_email }}</a> — we’re in early access and would love your input.
                </p>
                {% if unsubUrl is defined and unsubUrl %}
                  <p class="small text-muted" style="margin:0 0 0 0; color:#6b7280; font-size:12px;">
                    Unsubscribe instantly:
                    <a href="{{ unsubUrl }}" target="_blank" rel="noopener" style="color:#374151;">{{ unsubUrl }}</a>
                  </p>
                {% endif %}
              </td>
            </tr>

            <tr>
              <td style="padding:16px 24px 24px 24px; background:#f9fafb; border-top:1px solid #e5e7eb;">
                <p class="small text-muted" style="margin:0 0 4px 0; color:#6b7280; font-size:12px;">— {{ company_name }}</p>
                <p class="small text-muted" style="margin:0; color:#6b7280; font-size:12px;">{{ company_address }}</p>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
  </html>
