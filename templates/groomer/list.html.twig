{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/blocks/hero.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/blocks/sort-dropdown.css') }}">
{% endblock %}

{% block body %}
    {# Page anchors/regions, in order #}
    <section id="hero" class="hero hero--listing" aria-label="Hero">
      <div class="hero__inner">
        <h1 class="hero__title">
          Mobile Dog Grooming in {{ city.name }} ‚Äî We Come to You!
        </h1>
        <p class="hero__subtitle">
          Browse vetted local groomers that come straight to your doorstep.
        </p>
        <button class="hero__cta" data-scroll-target="#groomer-listings">
          Find a Groomer Now ‚Üí
        </button>
      </div>
    </section>

    <section id="how-it-works" aria-label="How It Works"></section>

    <section id="trust-info" aria-label="Trust & Safety Information">
      <aside class="trust-box" aria-labelledby="trust-title">
        <h2 id="trust-title" class="u-visually-hidden">Trust & Safety</h2>
        <div class="trust-box__item">
          <span class="trust-box__icon" aria-hidden="true">üõ°Ô∏è</span>
          <button
            class="trust-box__label"
            aria-describedby="trust-tip"
            data-tooltip="Verified groomer: Background checked and approved by CleanWhiskers."
          >
            Verified groomer
          </button>
          <span id="trust-tip" role="tooltip" class="tooltip tooltip--hidden"></span>
        </div>
      </aside>
    </section>

    <section id="controls" aria-label="Listing Controls">
        <h2 class="u-visually-hidden">Groomers in {{ city.name }} for {{ service.name }}</h2>
        {# Sorting dropdown #}
        {% set currentSort = app.request.query.get('sort', 'recommended') %}
        <div class="sort sort--dropdown" id="sort-control">
          <label for="sort" class="sort__label">Sort by</label>
          <select id="sort" class="sort__select" aria-label="Sort groomers">
            <option value="recommended" {{ currentSort == 'recommended' ? 'selected' }}>Recommended</option>
            <option value="price_asc" {{ currentSort == 'price_asc' ? 'selected' }}>Price (low to high)</option>
            <option value="rating_desc" {{ currentSort == 'rating_desc' ? 'selected' }}>Rating (high to low)</option>
          </select>
        </div>
    </section>

    <section id="groomer-listings" class="cards" aria-label="Groomer Listings">
      {% for groomer in groomers %}
        <article class="card" itemscope itemtype="https://schema.org/LocalBusiness">
          <a href="{{ path('app_groomer_show', {slug: groomer.slug}) }}" class="card__media">
            <img
              src="https://placehold.co/400x300?text=Groomer"
              alt="{{ groomer.businessName }} photo"
              loading="lazy"
              decoding="async"
              width="400"
              height="300"
            >
          </a>
          <div class="card__body">
            <h3 class="card__title" itemprop="name">
              <a href="{{ path('app_groomer_show', {slug: groomer.slug}) }}">{{ groomer.businessName }}</a>
              {% if groomer.user is not null %}
                {# Verified badge with tooltip (reuses assets/controllers/tooltip.js) #}
                {% set tipId = 'verified-tip-' ~ loop.index %}
                <button
                  type="button"
                  class="card__badge"
                  data-tooltip="Verified groomer: Background checked and approved by CleanWhiskers."
                  aria-label="Verified"
                  aria-describedby="{{ tipId }}"
                >üõ°Ô∏è</button>
                <span id="{{ tipId }}" role="tooltip" class="tooltip tooltip--hidden"></span>
              {% endif %}
            </h3>

            <p class="card__desc u-truncate-2">{{ groomer.about }}</p>

            <div class="card__meta">
              <span class="card__rating" aria-label="Average rating ‚Äî">‚òÖ ‚Äî</span>
              <span class="card__count">(0)</span>
              <span class="card__price">{{ groomer.price is not null ? groomer.price ~ ' BGN' : 'Price on request' }}</span>
            </div>

            {# Optional testimonial block ‚Äî not rendered without data #}
            {# Intentionally omitted as entity does not contain testimonial fields #}

            <a class="card__cta" href="{{ path('app_groomer_show', {slug: groomer.slug}) }}">Book Now</a>
          </div>
        </article>
      {% else %}
        <p>No groomers found.</p>
      {% endfor %}
    </section>

    {% if groomers %}
      <div class="pagination">
        {% set q = app.request.query.all %}
        {% if has_prev %}
          {% set q = q|merge({'page': page - 1, 'sort': currentSort}) %}
          <a href="?{{ q|url_encode }}">Previous</a>
        {% endif %}
        {% if has_next %}
          {% set q2 = app.request.query.all|merge({'page': page + 1, 'sort': currentSort}) %}
          <a href="?{{ q2|url_encode }}">Next</a>
        {% endif %}
      </div>
    {% endif %}

    <section id="seo-content" aria-label="SEO Content"></section>

    <section id="email-capture" aria-label="Email Capture"></section>
{% endblock %}
