{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/blocks/hero.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/blocks/sort-dropdown.css') }}">
    {# Reuse homepage groomer card/grid styles #}
    <link rel="stylesheet" href="{{ asset('styles/blocks/groomer-card.css') }}">
    <link rel="stylesheet" href="{{ asset('css/components/card-groomer.css') }}">
{% endblock %}

{% block body %}
    {# Page anchors/regions, in order #}
    <section id="hero" class="hero hero--listing" aria-label="Hero">
      <div class="hero__inner">
        <h1 class="hero__title">
          Mobile Dog Grooming in {{ city.name }} ‚Äî We Come to You!
        </h1>
        <p class="hero__subtitle">
          Browse vetted local groomers that come straight to your doorstep.
        </p>
        <button class="hero__cta" data-scroll-target="#groomer-listings">
          Find a Groomer Now ‚Üí
        </button>
      </div>
    </section>

    <section id="how-it-works" aria-label="How It Works"></section>

    <section id="trust-info" aria-label="Trust & Safety Information">
      <aside class="trust-box" aria-labelledby="trust-title">
        <h2 id="trust-title" class="u-visually-hidden">Trust & Safety</h2>
        <div class="trust-box__item">
          <span class="trust-box__icon" aria-hidden="true">üõ°Ô∏è</span>
          <button
            class="trust-box__label"
            aria-describedby="trust-tip"
            data-tooltip="Verified groomer: Background checked and approved by CleanWhiskers."
          >
            Verified groomer
          </button>
          <span id="trust-tip" role="tooltip" class="tooltip tooltip--hidden"></span>
        </div>
      </aside>
    </section>

    <section id="controls" aria-label="Listing Controls">
        <h2 class="u-visually-hidden">Groomers in {{ city.name }} for {{ service.name }}</h2>
        {# Sorting dropdown #}
        {% set currentSort = app.request.query.get('sort', 'recommended') %}
        <div class="sort sort--dropdown" id="sort-control">
          <label for="sort" class="sort__label">Sort by</label>
          <select id="sort" class="sort__select" aria-label="Sort groomers">
            <option value="recommended" {{ currentSort == 'recommended' ? 'selected' }}>Recommended</option>
            <option value="price_asc" {{ currentSort == 'price_asc' ? 'selected' }}>Price (low to high)</option>
            <option value="rating_desc" {{ currentSort == 'rating_desc' ? 'selected' }}>Rating (high to low)</option>
          </select>
        </div>
    </section>

    <section id="groomer-listings" class="featured-groomers" aria-label="Groomer Listings">
      <div class="featured-groomers__grid">
        {% for groomer in groomers %}
            {% set avg = ratings[groomer.id] ?? 0 %}
            {% set count = reviewCounts[groomer.id] ?? 0 %}
            {% set badges = [] %}
            {% if groomer.verified %}
                {% set badges = badges|merge(['Verified']) %}
            {% endif %}
            {{ include('partials/_groomer-card.html.twig', {
                profile: groomer,
                rating: avg,
                reviewCount: count,
                badges: badges,
                class: 'city-list-groomer'
            }) }}
        {% else %}
            <p>No groomers found.</p>
        {% endfor %}
      </div>
    </section>

    {% if groomers %}
      <div class="pagination">
        {% set q = app.request.query.all %}
        {% if has_prev %}
          {% set q = q|merge({'page': page - 1, 'sort': currentSort}) %}
          <a href="?{{ q|url_encode }}">Previous</a>
        {% endif %}
        {% if has_next %}
          {% set q2 = app.request.query.all|merge({'page': page + 1, 'sort': currentSort}) %}
          <a href="?{{ q2|url_encode }}">Next</a>
        {% endif %}
      </div>
    {% endif %}

    <section id="seo-content" aria-label="SEO Content"></section>

    <section id="email-capture" aria-label="Email Capture"></section>
{% endblock %}
