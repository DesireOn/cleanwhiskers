{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/components/button.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/blocks/hero.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/blocks/sort-dropdown.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/blocks/trust-box.css') }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="module" src="{{ asset('controllers/heroScroll.js') }}" defer></script>
    <script type="module" src="{{ asset('controllers/sortHandler.js') }}" defer></script>
    <script type="module" src="{{ asset('controllers/tooltip.js') }}" defer></script>
{% endblock %}

{% block body %}
    <section class="hero">
        <img class="hero__image" src="/images/hero-placeholder.jpg" alt="" />
        <div class="hero__container">
            <h1 class="hero__title">Mobile Dog Grooming in {{ city.name }} ‚Äî We Come to You!</h1>
            <p class="hero__subtitle">Browse vetted local groomers that come straight to your doorstep.</p>
            <button class="hero__cta btn btn--accent" type="button" data-scroll-target="#groomer-listings">Find a Groomer Now</button>
        </div>
    </section>

    <section id="groomer-listings">
        <div class="trust-box">
            <span class="trust-box__label" data-tooltip aria-describedby="verified-tooltip">üõ°Ô∏è Verified groomer</span>
            <span id="verified-tooltip" class="trust-box__tooltip" role="tooltip" aria-hidden="true">Verified groomer: Background checked and approved by CleanWhiskers.</span>
        </div>
        <h2>Groomers in {{ city.name }} for {{ service.name }}</h2>
        <div class="sort-dropdown">
            <label for="sort" class="sort-dropdown__label">Sort by:</label>
            {% set currentSort = app.request.query.get('sort') %}
            <select id="sort" class="sort-dropdown__select">
                <option value="recommended"{% if currentSort is null or currentSort == 'recommended' %} selected{% endif %}>Recommended</option>
                <option value="price"{% if currentSort == 'price' %} selected{% endif %}>Price (low to high)</option>
                <option value="rating"{% if currentSort == 'rating' %} selected{% endif %}>Rating (high to low)</option>
            </select>
        </div>
        <form method="get" autocomplete="off">
            <label for="rating">Minimum rating:</label>
            <select id="rating" name="rating">
                <option value="">Any</option>
                {% for i in 5..1 %}
                    <option value="{{ i }}"{% if rating == i %} selected{% endif %}>{{ i }}+</option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>
        {% if groomers %}
            <ul>
            {% for groomer in groomers %}
                <li>
                    <a href="/groomers/{{ groomer.slug }}">{{ groomer.businessName }}</a>
                    {% if testimonials[groomer.id] is defined %}
                        <blockquote>{{ testimonials[groomer.id].quote }}</blockquote>
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
            <div class="pagination">
                {% if previousOffset is not null %}
                    <a href="?offset={{ previousOffset }}{% if rating %}&rating={{ rating }}{% endif %}">Previous</a>
                {% endif %}
                {% if nextOffset is not null %}
                    <a href="?offset={{ nextOffset }}{% if rating %}&rating={{ rating }}{% endif %}">Next</a>
                {% endif %}
            </div>
        {% else %}
            <p>No results yet.</p>
        {% endif %}
    </section>
{% endblock %}
